# pchan-bot

Бот для пересылки голосований, которые содержат "Анонс:" в тексте вопроса.

## Настройка

1. Создайте нового бота через [@BotFather](https://t.me/BotFather) и получите токен бота
2. Добавьте бота в исходные чаты (откуда нужно пересылать голосования)
3. Добавьте бота в целевой чат (куда будут пересылаться голосования)
4. Получите ID целевого чата:
   - Добавьте [@userinfobot](https://t.me/userinfobot) в целевой чат
   - Перешлите любое сообщение из целевого чата боту @userinfobot
   - Бот покажет ID чата
5. Скопируйте файл `.env.example` в `.env` и заполните:
   ```
   BOT_TOKEN=ваш_токен_бота
   TARGET_CHAT_ID=id_целевого_чата
   ```

## Запуск через Docker (рекомендуется)

1. Установите [Docker](https://docs.docker.com/get-docker/) и [Docker Compose](https://docs.docker.com/compose/install/)

2. Запустите бота одним из способов:

### Способ 1: Автоматическое развертывание (рекомендуется)

Используйте скрипт `deploy.sh` для автоматического развертывания:

```bash
# Prod режим (по умолчанию)
./deploy.sh

# Prod режим
./deploy.sh .env.prod

# С указанием другого env файла
./deploy.sh .env.dev
```

Скрипт автоматически:

- Получает последние изменения из git
- Проверяет наличие env файла
- Останавливает текущий контейнер
- Собирает и запускает новый контейнер
- Проверяет успешность запуска

### Способ 2: Ручное управление

Если вам нужен более тонкий контроль:

```bash
# Dev режим (по умолчанию)
docker compose up -d

# Prod режим
ENV_FILE=.env.prod docker compose up -d

# Просмотр логов
docker compose logs -f

# Остановка бота
docker compose down
```

## Запуск без Docker

1. Установите зависимости:

   ```bash
   npm install
   ```

2. Запустите бота:
   ```bash
   npm run dev
   ```

## Использование

1. Добавьте бота как администратора в чаты, где создаются голосования
2. Бот будет автоматически пересылать в целевой чат все голосования, текст которых начинается с "Анонс:" (без учета регистра)
3. В консоли будут отображаться логи о пересылке голосований
